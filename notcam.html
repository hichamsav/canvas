<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotCam Emulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000000;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .app-container {
            width: 100%;
            max-width: 600px;
            background: #000000;
            border: 1px solid #333333;
        }

        /* شريط العنوان */
        .title-bar {
            background: #111111;
            padding: 8px 15px;
            border-bottom: 1px solid #333333;
            font-size: 14px;
            color: #cccccc;
            text-align: center;
        }

        /* منطقة الكاميرا */
        .camera-view {
            width: 100%;
            height: 400px;
            background: #000000;
            position: relative;
            border-bottom: 1px solid #333333;
        }

        #cameraVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* مؤشر التقاط */
        .capture-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 70px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .capture-indicator:active {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-50%) scale(0.95);
        }

        .capture-inner {
            width: 50px;
            height: 50px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
        }

        /* معلومات الصورة - تحت الكاميرا مباشرة */
        .image-info {
            padding: 15px;
            background: #000000;
            border-bottom: 1px solid #333333;
        }

        .info-line {
            margin: 3px 0;
            font-size: 14px;
            line-height: 1.4;
            color: #ffffff;
            font-family: 'Courier New', monospace;
        }

        /* الشعار - بالأسفل تمامًا */
        .logo {
            padding: 10px 15px;
            text-align: center;
            background: #000000;
            font-size: 13px;
            color: #888888;
            border-top: 1px solid #333333;
        }

        /* تحكم */
        .controls {
            padding: 15px;
            background: #111111;
            border-top: 1px solid #333333;
        }

        .control-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            background: #222222;
            border: 1px solid #444444;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            cursor: pointer;
            border-radius: 3px;
        }

        .btn:hover {
            background: #333333;
        }

        .btn-primary {
            background: #1a5fb4;
            border-color: #1a5fb4;
        }

        .btn-primary:hover {
            background: #1c71d8;
        }

        /* معرض الصور */
        .gallery {
            padding: 15px;
            background: #111111;
            border-top: 1px solid #333333;
        }

        .gallery-title {
            font-size: 14px;
            color: #cccccc;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #333333;
        }

        .gallery-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .gallery-item {
            position: relative;
            border: 1px solid #333333;
        }

        .gallery-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }

        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: #ff5555;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
        }

        /* حالة التطبيق */
        .status {
            padding: 10px 15px;
            background: #111111;
            border-top: 1px solid #333333;
            font-size: 12px;
            color: #888888;
        }

        @media (max-width: 768px) {
            .camera-view {
                height: 350px;
            }
            
            body {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- شريط العنوان -->
        <div class="title-bar">
            NotCam Emulator
        </div>

        <!-- العرض المباشر للكاميرا -->
        <div class="camera-view">
            <video id="cameraVideo" autoplay playsinline></video>
            <div class="capture-indicator" id="captureBtn">
                <div class="capture-inner"></div>
            </div>
        </div>

        <!-- معلومات الصورة - تحت الكاميرا مباشرة -->
        <div class="image-info">
            <div class="info-line" id="locationLine">Latitude: 33.603039</div>
            <div class="info-line" id="longitudeLine">Longitude: -7.636531</div>
            <div class="info-line" id="elevationLine">Élévation: 10.64±10.9 m</div>
            <div class="info-line" id="precisionLine">Précision: 77.6 m</div>
            <div class="info-line" id="timeLine">Temps: 31-12-2025 17:49</div>
        </div>

        <!-- الشعار - بالأسفل -->
        <div class="logo">
            Powered by NotCam
        </div>

        <!-- التحكم -->
        <div class="controls">
            <div class="control-row">
                <button id="toggleCamera" class="btn btn-primary">تشغيل الكاميرا</button>
                <button id="downloadBtn" class="btn" disabled>تحميل الصورة</button>
            </div>
            <div class="control-row">
                <button id="refreshLocation" class="btn">تحديث الموقع</button>
                <button id="settingsBtn" class="btn">الإعدادات</button>
            </div>
        </div>

        <!-- معرض الصور -->
        <div class="gallery">
            <div class="gallery-title">الصور الملتقطة</div>
            <div id="galleryItems" class="gallery-items">
                <!-- ستظهر الصور هنا -->
            </div>
        </div>

        <!-- الحالة -->
        <div class="status" id="statusText">
            جاهز للبدء
        </div>
    </div>

    <script>
        // العناصر الرئيسية
        const video = document.getElementById('cameraVideo');
        const captureBtn = document.getElementById('captureBtn');
        const toggleCameraBtn = document.getElementById('toggleCamera');
        const downloadBtn = document.getElementById('downloadBtn');
        const refreshLocationBtn = document.getElementById('refreshLocation');
        const statusText = document.getElementById('statusText');
        
        // عناصر المعلومات
        const locationLine = document.getElementById('locationLine');
        const longitudeLine = document.getElementById('longitudeLine');
        const elevationLine = document.getElementById('elevationLine');
        const precisionLine = document.getElementById('precisionLine');
        const timeLine = document.getElementById('timeLine');
        
        // المتغيرات
        let stream = null;
        let isCameraOn = false;
        let currentImage = null;
        const galleryItems = document.getElementById('galleryItems');
        
        // بيانات الموقع الافتراضية (نفس الصورة المرسلة)
        let locationData = {
            latitude: 33.603039,
            longitude: -7.636531,
            elevation: "10.64±10.9 m",
            precision: "77.6 m"
        };
        
        // تحديث الوقت
        function updateTime() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            timeLine.textContent = `Temps: ${day}-${month}-${year} ${hours}:${minutes}`;
        }
        
        // تحديث بيانات الموقع
        function updateLocation() {
            locationLine.textContent = `Latitude: ${locationData.latitude}`;
            longitudeLine.textContent = `Longitude: ${locationData.longitude}`;
            elevationLine.textContent = `Élévation: ${locationData.elevation}`;
            precisionLine.textContent = `Précision: ${locationData.precision}`;
        }
        
        // الحصول على الموقع الحقيقي
        function getRealLocation() {
            if (navigator.geolocation) {
                statusText.textContent = "جاري الحصول على الموقع...";
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        locationData.latitude = position.coords.latitude.toFixed(6);
                        locationData.longitude = position.coords.longitude.toFixed(6);
                        locationData.precision = `${position.coords.accuracy.toFixed(1)} m`;
                        
                        // إضافة تغيير بسيط في الارتفاع لمحاكاة البيانات الحقيقية
                        const baseElevation = 10.64;
                        const variation = (Math.random() * 2 - 1).toFixed(2);
                        locationData.elevation = `${(parseFloat(baseElevation) + parseFloat(variation)).toFixed(2)}±10.9 m`;
                        
                        updateLocation();
                        statusText.textContent = "تم تحديث بيانات الموقع";
                    },
                    (error) => {
                        statusText.textContent = "تعذر الحصول على الموقع، استخدام بيانات افتراضية";
                        updateLocation();
                    }
                );
            } else {
                statusText.textContent = "المتصفح لا يدخدم خدمة الموقع";
                updateLocation();
            }
        }
        
        // تشغيل/إيقاف الكاميرا
        async function toggleCamera() {
            if (!isCameraOn) {
                try {
                    statusText.textContent = "جاري تشغيل الكاميرا...";
                    
                    stream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            width: { ideal: 1280 },
                            height: { ideal: 720 },
                            facingMode: 'environment'
                        },
                        audio: false
                    });
                    
                    video.srcObject = stream;
                    isCameraOn = true;
                    
                    toggleCameraBtn.textContent = "إيقاف الكاميرا";
                    captureBtn.style.display = 'flex';
                    statusText.textContent = "الكاميرا تعمل - جاهز للتقاط الصور";
                    
                } catch (err) {
                    console.error("خطأ في تشغيل الكاميرا:", err);
                    statusText.textContent = `خطأ: ${err.message}`;
                    alert(`تعذر تشغيل الكاميرا: ${err.message}`);
                }
            } else {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    stream = null;
                }
                
                video.srcObject = null;
                isCameraOn = false;
                
                toggleCameraBtn.textContent = "تشغيل الكاميرا";
                captureBtn.style.display = 'none';
                statusText.textContent = "الكاميرا متوقفة";
            }
        }
        
        // التقاط صورة
        async function captureImage() {
            if (!isCameraOn || !stream) {
                alert("يجب تشغيل الكاميرا أولاً!");
                return;
            }
            
            try {
                statusText.textContent = "جاري التقاط الصورة...";
                
                // إنشاء canvas
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                // ضبط أبعاد canvas
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // رسم الفيديو على canvas
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // تحويل إلى blob
                const blob = await new Promise(resolve => {
                    canvas.toBlob(resolve, 'image/jpeg', 0.85);
                });
                
                // إنشاء URL للصورة
                const imageUrl = URL.createObjectURL(blob);
                currentImage = imageUrl;
                
                // تحديث المعلومات مع الوقت الحالي
                updateTime();
                
                // إضافة الصورة للمعرض
                addToGallery(imageUrl, blob);
                
                // تمكين زر التحميل
                downloadBtn.disabled = false;
                
                statusText.textContent = "تم التقاط الصورة بنجاح!";
                
                // تأثير بصري
                captureBtn.style.transform = 'translateX(-50%) scale(0.95)';
                setTimeout(() => {
                    captureBtn.style.transform = 'translateX(-50%) scale(1)';
                }, 100);
                
            } catch (err) {
                console.error("خطأ في التقاط الصورة:", err);
                statusText.textContent = `خطأ في التقاط الصورة: ${err.message}`;
            }
        }
        
        // إضافة صورة للمعرض
        function addToGallery(imageUrl, blob) {
            const galleryItem = document.createElement('div');
            galleryItem.className = 'gallery-item';
            
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = 'صورة ملتقطة';
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = '×';
            deleteBtn.onclick = function(e) {
                e.stopPropagation();
                if (confirm("هل تريد حذف هذه الصورة؟")) {
                    galleryItem.remove();
                    URL.revokeObjectURL(imageUrl);
                    statusText.textContent = "تم حذف الصورة";
                }
            };
            
            galleryItem.appendChild(img);
            galleryItem.appendChild(deleteBtn);
            
            // إضافة حدث النقر للتحميل
            galleryItem.onclick = function() {
                downloadImage(imageUrl, `NotCam_${new Date().getTime()}.jpg`);
            };
            
            galleryItems.insertBefore(galleryItem, galleryItems.firstChild);
        }
        
        // تحميل الصورة
        function downloadImage(imageUrl, filename) {
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            statusText.textContent = `تم تحميل الصورة: ${filename}`;
        }
        
        // تهيئة التطبيق
        function initApp() {
            // تحديث الوقت أولاً
            updateTime();
            
            // تحديث الموقع
            updateLocation();
            
            // تحديث الوقت كل دقيقة
            setInterval(updateTime, 60000);
            
            // إضافة مستمعي الأحداث
            toggleCameraBtn.addEventListener('click', toggleCamera);
            captureBtn.addEventListener('click', captureImage);
            downloadBtn.addEventListener('click', () => {
                if (currentImage) {
                    const now = new Date();
                    const dateStr = `${String(now.getDate()).padStart(2, '0')}-${String(now.getMonth() + 1).padStart(2, '0')}-${now.getFullYear()}`;
                    const timeStr = `${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}`;
                    downloadImage(currentImage, `NotCam_${dateStr}_${timeStr}.jpg`);
                }
            });
            
            refreshLocationBtn.addEventListener('click', getRealLocation);
            
            // إعدادات زر
            document.getElementById('settingsBtn').addEventListener('click', () => {
                alert("الإعدادات:\n- التقاط مباشر من الكاميرا\n- تنسيق التاريخ الفرنسي\n- بيانات الموقع\n- دقة عالية");
            });
        }
        
        // بدء التطبيق
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
