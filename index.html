<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8" />
    <title>EXTRACTION CANVAS</title>
    <style>
        body {
            direction: rtl;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            padding-top: 100px; /* âœ… Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ */
            display: flex;
            gap: 10px;
            height: 100vh;
            font-size: 13px;
            overflow: hidden; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
            box-sizing: border-box;
        }

        .container {
            flex: 1;
            max-width: 50%;
            display: flex;
            flex-direction: column;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
            overflow: hidden;
        }
.header-logo {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    text-align: center;
}

.header-logo img {
    height: 60px; /* ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ø­Ø³Ø¨ Ø´Ø¹Ø§Ø±Ùƒ */
    object-fit: contain;
}

        h1, h2, h3 {
            font-size: 16px;
            margin-top: 0;
            text-align: center;
        }

        input[type="file"],
        input[type="text"],
        textarea {
            width: 100%;
            font-size: 12px;
            padding: 8px;
            margin-bottom: 8px;
            box-sizing: border-box;
            font-family: monospace;
            height: 60px;
            resize: none;
        }

        button {
            padding: 6px 10px;
            font-size: 13px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            margin-bottom: 8px;
            transition: background-color 0.3s ease;
        }

            button:hover {
                background-color: #0056b3;
            }

        .copy-button {
            background-color: #28a745;
        }

            .copy-button:hover {
                background-color: #1e7e34;
            }

        .row {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .field-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .line-count {
            font-weight: bold;
            font-size: 12px;
            color: #007bff;
            text-align: center;
            margin-bottom: 4px;
        }

        label {
            font-weight: bold;
            font-size: 12px;
            margin-bottom: 4px;
        }

            #keyword,
            label[for="keyword"] {
                display: none;
            }
    </style>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
<div class="header-logo">
    <img src="https://www.vernegroup.com/wp-content/uploads/2021/08/Image-1-1-1.png" alt="Ø§Ù„Ø´Ø¹Ø§Ø±" />
</div>

    <div class="container" style="max-width: 45%;">
        <h1 style="text-align: center;">ğŸ“ EXTRACTION CANVAS ğŸ“</h1>
        <input type="file" id="folderInput" webkitdirectory directory multiple accept=".txt,.html" />
        <button onclick="mergeFolderTxt()">Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª</button>

<textarea id="filteredOutput" rows="10" style="display:none;"></textarea>

        <h3>ğŸ” Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙƒÙ„Ù…Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)</h3>
        <input type="text" id="singleKeywordInput" value="ReÃ§u le,Envoy,Sent,ID CASE,Client :,Tï¿½lï¿½phone,Accï¿½s rï¿½seau,Activitï¿½s de service,TÃ©lÃ©phone,AccÃ¨s rÃ©seau,Adresse,-Adresse,ville,ActivitÃ©s de service,Commentaire,Adresse Installation" />
        <label><input type="checkbox" id="startOnlySingleCheckbox" checked /> Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙÙ‚Ø· Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ØªÙŠ <strong>ØªØ¨Ø¯Ø£</strong> Ø¨Ø§Ù„ÙƒÙ„Ù…Ø§Øª</label><br />
        <button onclick="extractSingleKeyword()">ğŸ” Ø§Ø³ØªØ®Ø±Ø§Ø¬</button>
<textarea id="singleKeywordOutput" rows="7" readonly placeholder="Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©"></textarea>
        <button onclick="copySingleKeyword()" class="copy-button">ğŸ“‹ Ù†Ø³Ø® Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</button>
    </div>

    <div class="container" style="max-width: 50%;">
        <div class="row">
            <div class="field-container">
                <div class="line-count" id="count0">0 Ø³Ø·Ø±</div>
                <textarea id="field0" readonly></textarea>
                <button class="copy-button" onclick="copyField(0)">ğŸ“‹ Ù†Ø³Ø® EnvoyÃ©</button>
            </div>
            <div class="field-container">
                <div class="line-count" id="count1">0 Ø³Ø·Ø±</div>
                <textarea id="field1" readonly></textarea>
                <button class="copy-button" onclick="copyField(1)">ğŸ“‹ Ù†Ø³Ø® ID CASE</button>
            </div>
            <div class="field-container">
                <div class="line-count" id="count2">0 Ø³Ø·Ø±</div>
                <textarea id="field2" readonly></textarea>
                <button class="copy-button" onclick="copyField(2)">ğŸ“‹ Ù†Ø³Ø® Client</button>
            </div>
        </div>

        <div class="row">
            <div class="field-container">
                <div class="line-count" id="count3">0 Ø³Ø·Ø±</div>
                <textarea id="field3" readonly></textarea>
                <button class="copy-button" onclick="copyField(3)">ğŸ“‹ Ù†Ø³Ø® TÃ©lÃ©phone</button>
            </div>
            <div class="field-container">
                <div class="line-count" id="count4">0 Ø³Ø·Ø±</div>
                <textarea id="field4" readonly></textarea>
                <button class="copy-button" onclick="copyField(4)">ğŸ“‹ Ù†Ø³Ø® AccÃ¨s rÃ©seau</button>
            </div>
            <div class="field-container">
                <div class="line-count" id="count5">0 Ø³Ø·Ø±</div>
                <textarea id="field5" readonly></textarea>
                <button class="copy-button" onclick="copyField(5)">ğŸ“‹ Ù†Ø³Ø® ActivitÃ©s de service</button>
            </div>
        </div>

        <div class="row">
            <div class="field-container">
                <div class="line-count" id="count6">0 Ø³Ø·Ø±</div>
                <textarea id="field6" readonly></textarea>
                <button class="copy-button" onclick="copyField(6)">ğŸ“‹ Ù†Ø³Ø® Adresse Installation</button>
            </div>
        </div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
    <button onclick="removeDuplicatesAndAutoCopy()" style="background-color:#dc3545; color:white;">ğŸ§¹ Remove & Copy ALL ğŸ§¹ </button>
    <button onclick="exportToExcel()" style="background-color:#ff6600; color:white;">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
    <span id="countdown" style="font-weight: bold; color: red; font-size: 14px; margin-right: 10px;"></span>
</div>



        <script>
            window.alert = function() {};
            const originalAlert = window.alert;

window.alert = function(message) {
  if (typeof message === 'string' && message.includes('hichamsav.github.io')) {
    // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¡ (ØªÙ…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹Ùƒ)
    return;
  }
  // ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ØŒ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙƒÙ…Ø§ Ù‡Ùˆ
  originalAlert(message);
};
            document.addEventListener("contextmenu", e => e.preventDefault());
            document.addEventListener("keydown", e => {
                if (e.key === "F12" || (e.ctrlKey && ["u", "s"].includes(e.key.toLowerCase())) || (e.ctrlKey && e.shiftKey && ["I", "J"].includes(e.key))) { e.preventDefault(); return false; }
            });

            let originalMergedContent = "";



function mergeFolderTxt() {
    const files = Array.from(document.getElementById("folderInput").files).filter(f => f.name.toLowerCase().endsWith(".txt"));
    if (!files.length) {
        alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù„Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª .txt.");
        return;
    }

    files.sort((a, b) => a.name.localeCompare(b.name));
    let merged = "";
    let processed = 0;

    files.forEach(f => {
        const reader = new FileReader();
        reader.onload = e => {
            merged += `\n===== ${f.name} =====\n` + e.target.result + "\n";
            processed++;
            if (processed === files.length) {
                originalMergedContent = merged;
                document.getElementById("filteredOutput").value = merged;
                extractSingleKeyword();

            }
        };
        reader.readAsText(f);
    });
}



            function extractSingleKeyword() {
                const keywordText = document.getElementById("singleKeywordInput").value.trim();
                const startOnly = document.getElementById("startOnlySingleCheckbox").checked;
                if (!keywordText) { alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø£ÙƒØ«Ø± Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø© Ù„Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬."); return; }
                const keywords = keywordText.split(",").map(k => k.trim()).filter(k => k.length > 0);
                const lines = document.getElementById("filteredOutput").value.split("\n");
                const extracted = [];
                let buffer = [];
                let skip = false;
                for (const line of lines) {
                    const regexSkip = /sans\s+ca[\w\-]*/i; // ÙŠØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ "sans" ÙŠÙ„ÙŠÙ‡Ø§ ÙƒÙ„Ù…Ø© ØªØ¨Ø¯Ø£ Ø¨Ù€ ca
                    if (regexSkip.test(line)) {
                        buffer = [];
                        skip = true;
                        continue;
                    }
                    if (skip && line.includes("Adresse Installation")) { skip = false; continue; }
                    buffer.push(line);
                    if (keywords.some(k => line.startsWith(k))) {
                        extracted.push(...buffer);
                        buffer = [];
                    }
                }
                document.getElementById("singleKeywordOutput").value = extracted.join("\n");
                filterAndDistribute();
            }

            function copySingleKeyword() { const t = document.getElementById("singleKeywordOutput"); t.select(); document.execCommand("copy"); window.getSelection().removeAllRanges(); }

            function getTextAfterColon(line) {
                const parts = line.split(":");
                return parts.length > 1 ? parts.slice(1).join(":").trim() : line.trim();
            }

            function startsWithAny(line, keywords) {
                return keywords.find(keyword => line.toLowerCase().startsWith(keyword.toLowerCase()));
            }

function filterAndDistribute() {
    const text = document.getElementById('singleKeywordOutput').value.split("\n");
    const fields = Array.from({ length: 7 }, () => []);
    let current = {};
    let adresseValue = "";  // Ù„ØªØ®Ø²ÙŠÙ† Adresse Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
    let villeValue = "";    // Ù„ØªØ®Ø²ÙŠÙ† Ville Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ

    function cleanValue(line, keyword) {
        let value = "";
        if (line.includes(":")) {
            value = line.split(":").slice(1).join(":").trim();
        } else {
            value = line.replace(new RegExp("^" + keyword, "i"), "").trim();
        }
        value = decodeCorruptedCharacters(value);
        return value;
    }

function decodeCorruptedCharacters(text) {
    return text
        .replace(/ï¿½/g, "Ã©")
        .replace(/ÃƒÂ©/g, "Ã©")
        .replace(/ÃƒÂ¨/g, "Ã¨")
        .replace(/Ãƒ/g, "Ã ")
        .replace(/ÃƒÂ´/g, "Ã´")
        .replace(/ÃƒÂª/g, "Ãª")
        .replace(/ÃƒÂ¢/g, "Ã¢")
        .replace(/ÃƒÂ¼/g, "Ã¼")
        .replace(/ÃƒÂ§/g, "Ã§")
        .replace(/Ã‚/g, "");
        // ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø°ÙŠ ÙŠØ­Ø°Ù Ø§Ù„Ø­Ø±ÙˆÙ ØºÙŠØ± ASCII
}


    function normalizePhone(phone) {
        return phone.startsWith("0") ? phone.substring(1) : phone;
    }

    function startsWithAnyStrict(line, keywords) {
        line = line.trimStart();
        for (let keyword of keywords) {
            const regex = new RegExp("^" + keyword.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&') + "\\s*:", "i");
            if (regex.test(line)) return keyword;
        }
        return null;
    }

    for (let i = 0; i < text.length; i++) {
        const line = text[i].trim();

        // Ø¨Ø¯Ø§ÙŠØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ (ID CASE) â†’ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† adresseValue Ùˆ villeValue
        if (startsWithAnyStrict(line, ["ID CASE"])) {
            adresseValue = "";
            villeValue = "";
        }

        // ØªØ®Ø²ÙŠÙ† Adresse Ø¥Ø°Ø§ ÙˆØ¬Ø¯Ù†Ø§Ù‡
        if (startsWithAnyStrict(line, ["Adresse"])) {
            adresseValue = cleanValue(line, "Adresse");
            continue;
        }

        // ØªØ®Ø²ÙŠÙ† Ville Ø¥Ø°Ø§ ÙˆØ¬Ø¯Ù†Ø§Ù‡
        if (startsWithAnyStrict(line, ["Ville"])) {
            villeValue = cleanValue(line, "Ville");
            continue;
        }

        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙƒÙ…Ø§ Ù‡ÙŠ
        const envoyKey = startsWithAnyStrict(line, ["EnvoyÃ©", "Envoyï¿½", "Sent", "ReÃ§u le"]);
        if (envoyKey) {
            current[0] = cleanValue(line, envoyKey);
            continue;
        }
        if (startsWithAnyStrict(line, ["ID CASE"])) {
            current[1] = cleanValue(line, "ID CASE");
            continue;
        }
        if (startsWithAnyStrict(line, ["Client"])) {
            current[2] = cleanValue(line, "Client");
            continue;
        }
        const telKey = startsWithAnyStrict(line, ["Tï¿½lï¿½phone", "TÃ©lÃ©phone"]);
        if (telKey) {
            current[3] = normalizePhone(cleanValue(line, telKey));
            continue;
        }
        const reseauKey = startsWithAnyStrict(line, ["Accï¿½s rï¿½seau", "AccÃ¨s rÃ©seau"]);
        if (reseauKey) {
            current[4] = normalizePhone(cleanValue(line, reseauKey));
            continue;
        }
        const activitesKey = startsWithAnyStrict(line, ["Activitï¿½s de service", "ActivitÃ©s de service"]);
        if (activitesKey) {
            let rawValue = cleanValue(line, activitesKey);
            let parts = rawValue.split("|");
            let lastPart = parts.length > 1 ? parts[parts.length - 1].trim() : rawValue.trim();
            lastPart = lastPart.replace(/[^\w\s\u00C0-\u017F]/g, '').trim();
            current[5] = lastPart;
            continue;
        }

        // Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Adresse Installation â† Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ø¬Ù„
        if (startsWithAnyStrict(line, ["Adresse Installation"])) {
            let adresseInstallationValue = cleanValue(line, "Adresse Installation");

            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Adresse Installation ÙØ§Ø±ØºØ©ØŒ Ù†Ø¹ÙˆØ¶ Ø¨Ù‚ÙŠÙ…Ø© adresseValue Ø£Ùˆ villeValue Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (!adresseInstallationValue) {
                adresseInstallationValue = adresseValue || villeValue || "";
            }

            current[6] = adresseInstallationValue;

            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ ÙƒØ§Ù…Ù„Ù‹Ø§ ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
            for (let j = 0; j <= 6; j++) {
                fields[j].push(current[j] || "");
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† current Ùˆ Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„Ù…Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
            current = {};
            adresseValue = "";
            villeValue = "";
            continue;
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    for (let i = 0; i <= 6; i++) {
        document.getElementById("field" + i).value = fields[i].join("\n");
        document.getElementById("count" + i).textContent = fields[i].length + " Ø³Ø·Ø±";
    }
}



function extractDateOnly(dateStr) {
    const months = {
        janvier: "01", fÃ©vrier: "02", fevrier: "02", mars: "03", avril: "04", mai: "05",
        juin: "06", juillet: "07", aoÃ»t: "08", aout: "08", septembre: "09",
        octobre: "10", novembre: "11", dÃ©cembre: "12", decembre: "12"
    };

    const match = dateStr.match(/(\d{1,2})\s+([a-zÃ©Ã»]+)\s+(\d{4})/i);

    if (match) {
        const day = match[1].padStart(2, "0");
        const month = months[match[2].toLowerCase()] || "01";
        const year = match[3];
        return `${day}/${month}/${year}`;
    }

    return "";
}

            function copyField(n) { const f = document.getElementById("field" + n); f.select(); document.execCommand("copy"); }

            function getSelectedDate() { return new Date().toLocaleDateString("fr-FR"); }

            function getFirstWord(text) { const w = (text || "").trim().split(/\s+/)[0]; return w ? w : "CASABLANCA"; }

            function parseFrenchDateToDDMMYYYY(str) {
                const months = {
                    janvier: "01", fÃ©vrier: "02", fevrier: "02", mars: "03", avril: "04", mai: "05",
                    juin: "06", juillet: "07", aoÃ©t: "08", aout: "08", septembre: "09",
                    octobre: "10", novembre: "11", dÃ©cembre: "12", decembre: "12"
                };

                // Ø¥Ø²Ø§Ù„Ø© Ø§Ø³Ù… Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ÙˆÙ‚Øª (Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø¹Ø¯ Ø§Ù„ÙˆÙ‚Øª)
                const dateString = str.replace(/^(?:\w+\s+)+(\d{1,2})\s+([a-zÃ©Ã»]+)\s+(\d{4})\s+\d{1,2}:\d{2}$/, '$1 $2 $3');

                const match = dateString.match(/(\d{1,2})\s+([a-zÃ©Ã»]+)\s+(\d{4})/i);

                if (match) {
                    const day = match[1].padStart(2, "0");
                    const month = months[match[2].toLowerCase()] || "01";
                    const year = match[3];

                    return `${day}/${month}/${year}`;
                }

                return ""; // ÙØ§Ø±Øº Ø¥Ø°Ø§ Ù„Ù… ÙŠØªØ·Ø§Ø¨Ù‚
            }


     function exportToExcel() {
    const fieldsData = [], numFields = 7;
    for (let i = 0; i < numFields; i++) {
        fieldsData[i] = document.getElementById("field" + i).value.split("\n");
    }
    const maxRows = Math.max(...fieldsData.map(arr => arr.length));
    const wsData = [];

    for (let r = 0; r < maxRows; r++) {
        const rawDateLine = fieldsData[0][r] || "";
        const parsedDate = parseFrenchDateToDDMMYYYY(rawDateLine);

        wsData[r] = [
            fieldsData[1][r] || "",
            fieldsData[4][r] || "",
            parsedDate || "",
            parsedDate || "",
            fieldsData[5][r] || "",
            fieldsData[6][r] || "",
            parsedDate || "",
            getValidLocationFromAddress(fieldsData[6][r]),
            fieldsData[3][r] || "",
            fieldsData[2][r] || "",
            "",
            "",
            parsedDate || ""
        ];
    }

    const ws = XLSX.utils.aoa_to_sheet(wsData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
    XLSX.writeFile(wb, "extracted_data.xlsx");
}

function copyExcelData() {
    const fieldsData = [], numFields = 7;
    for (let i = 0; i < numFields; i++) {
        fieldsData[i] = document.getElementById("field" + i).value.split("\n");
    }
    const maxRows = Math.max(...fieldsData.map(arr => arr.length));
    let text = "";

    for (let r = 0; r < maxRows; r++) {
        const rawDate = fieldsData[0][r] || "";
        const parsedDate = parseFrenchDateToDDMMYYYY(rawDate);

        const location = getValidLocationFromAddress(fieldsData[6][r]);

        const rowData = [
            fieldsData[1][r] || "",
            fieldsData[4][r] || "",
            parsedDate || "",
            parsedDate || "",
            fieldsData[5][r] || "",
            fieldsData[6][r] || "",
            parsedDate || "",
            location,
            fieldsData[3][r] || "",
            fieldsData[2][r] || "",
            "",
            "",
            parsedDate || ""
        ];

        text += rowData.join("\t") + "\n";
    }

    navigator.clipboard.writeText(text).catch(() => { });
}

// Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§ÙØ© Ù„ÙŠÚ¤Ù†Ø´ØªØ§ÙŠÙ† (Levenshtein Distance) Ø¨Ø³ÙŠØ·Ø© Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„ØªØ´Ø§Ø¨Ù‡
function levenshteinDistance(a, b) {
    const matrix = [];

    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø·ÙˆÙ„ Ø¨Ù…Ù‚Ø¯Ø§Ø± 1 Ù„ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ©
    for (let i = 0; i <= b.length; i++) {
        matrix[i] = [i];
    }
    for (let j = 0; j <= a.length; j++) {
        matrix[0][j] = j;
    }

    for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
            if (b.charAt(i - 1) === a.charAt(j - 1)) {
                matrix[i][j] = matrix[i - 1][j - 1];
            } else {
                matrix[i][j] = Math.min(
                    matrix[i - 1][j - 1] + 1, // ØªØ¨Ø¯ÙŠÙ„ Ø­Ø±Ù
                    matrix[i][j - 1] + 1,     // Ø­Ø°Ù Ø­Ø±Ù
                    matrix[i - 1][j] + 1      // Ø¥Ø¶Ø§ÙØ© Ø­Ø±Ù
                );
            }
        }
    }

    return matrix[b.length][a.length];
}

// Ø¯Ø§Ù„Ø© ØªØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ´Ø§Ø¨Ù‡ Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ù…Ø³Ø§ÙØ© Levenshtein
function isSimilar(word1, word2, threshold = 2) {
    return levenshteinDistance(word1.toLowerCase(), word2.toLowerCase()) <= threshold;
}

function getValidLocationFromAddress(address) {
    const validLocations = ["laayoune", "casablanca", "tetouan"];
    const corrections = {
        "casabalnca": "Casablanca",
        // Ø£Ø¶Ù Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø© Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
    };

    if (!address || address.trim() === "") return "Sans Adresse";

    const words = address.trim().split(/\s+/);
    const firstWord = words[0];

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØµØ­ÙŠØ­Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
    if (corrections[firstWord.toLowerCase()]) {
        return corrections[firstWord.toLowerCase()];
    }

    // ØªØ­Ù‚Ù‚ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¨Ø§Ø´Ø± Ø£ÙˆÙ„Ø§Ù‹
    for (const loc of validLocations) {
        if (firstWord.toLowerCase() === loc) {
            return capitalizeFirstLetter(loc);
        }
    }

    // ØªØ­Ù‚Ù‚ ØªØ·Ø§Ø¨Ù‚ ØªÙ‚Ø±ÙŠØ¨ÙŠ (ØªØ´Ø§Ø¨Ù‡ Ù…Ø¹ threshold Ù…Ø¹ÙŠÙ†)
    for (const loc of validLocations) {
        for (const word of words) {
            if (isSimilar(word, loc)) {
                return capitalizeFirstLetter(loc);
            }
        }
    }

    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙ„Ù…Ø§Øª Ù…ØµØ­Ø­Ø© ÙÙŠ Ø§Ù„Ø³Ø·Ø±
    for (const [wrong, correct] of Object.entries(corrections)) {
        if (address.toLowerCase().includes(wrong)) {
            return correct;
        }
    }

    // Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ·Ø§Ø¨Ù‚ØŒ Ù†Ø±Ø¬Ø¹ Ø£ÙˆÙ„ ÙƒÙ„Ù…Ø© ÙƒÙ…Ø§ Ù‡ÙŠ
    return firstWord;
}

function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}


       

function removeDuplicatesAndAutoCopy() {
    removeDuplicatesBasedOnField1(); // Ø£ÙˆÙ„Ø§Ù‹ Ù†Ø­Ø°Ù Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
    copyExcelData();                 // Ø«Ù… Ù†Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ
}

        </script>
</body>
</html>










