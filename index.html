<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>EXTRACTION CANVAS</title>
  <style>
    body {
      direction: rtl;
      font-family: Arial, sans-serif;
      margin: 0; padding: 20px;
      display: flex;
      gap: 20px;
      height: 100vh;
      box-sizing: border-box;
    }
    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
      text-align: center;
    }
    input[type="file"] {
      margin-bottom: 10px;
    }
    button {
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      margin-bottom: 15px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
    textarea, input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 13px;
      margin-bottom: 10px;
      box-sizing: border-box;
      resize: vertical;
      font-family: monospace, monospace;
    }
    .row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .field-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .field-container textarea {
      height: 90px;
      resize: vertical;
    }
    .copy-button {
      margin-top: 5px;
      background-color: #28a745;
    }
    .copy-button:hover {
      background-color: #1e7e34;
    }
    .line-count {
      font-weight: bold;
      margin-bottom: 5px;
      color: #007bff;
      text-align: center;
      user-select: none;
    }
    label {
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
    }
    /* إخفاء خانة الكلمات (الموقع الثاني) */
    #keyword, label[for="keyword"] {
      display: none;
    }
  </style>

  <!-- مكتبة SheetJS -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>

  <!-- القسم الأول - رفع ودمج ملفات TXT -->
  <div class="container" style="max-width: 45%;">
<h1 style="text-align: center;">📁 EXTRACTION CANVAS 📁</h1>
    <input type="file" id="folderInput" webkitdirectory directory multiple accept=".txt" />
    <button onclick="mergeFolderTxt()">دمج الملفات</button>

    <!-- النص بعد الدمج مخفي -->
    <textarea id="filteredOutput" rows="10" style="display:none;"></textarea>

    <h3>🔎 استخراج كلمات متعددة (مفصولة بفاصلة)</h3>
    <input
      type="text"
      id="singleKeywordInput"
      value="ID CASE,Client :,T�l�phone,Acc�s r�seau,Activit�s de service,Commentaire,Adresse Installation"
      placeholder="اكتب كلمة أو أكثر مفصولة بفاصلة"
    />
    <label>
      <input type="checkbox" id="startOnlySingleCheckbox" checked />
      استخراج فقط الأسطر التي <strong>تبدأ</strong> بالكلمات
    </label><br />
    <button onclick="extractSingleKeyword()">🔎 استخراج</button>
    <textarea id="singleKeywordOutput" rows="7" readonly placeholder="ستظهر هنا الأسطر التي تحتوي على الكلمات المختارة"></textarea>
    <button onclick="copySingleKeyword()" class="copy-button">📋 نسخ نتائج الاستخراج</button>
  </div>

  <!-- القسم الثاني - الفلترة والتوزيع -->
  <div class="container" style="max-width: 50%;">
    <label for="keyword">🔍 الكلمات (افصل بينها بـ +):</label>
    <input type="text" id="keyword" placeholder="مثال: خطأ+فشل+تحذير" value="SANS CA" />
    <button onclick="filterAndDistribute()" style="display:none;">🚀 تنفيذ</button>
<!-- 🟦 الصف الأول: خانات 1، 2، 3 -->
<div class="row">
  <div class="field-container">
    <div class="line-count" id="count1">0 سطر</div>
    <textarea id="field1" readonly></textarea>
    <button class="copy-button" onclick="copyField(1)">📋 نسخ الخانة 1</button>
  </div>
  <div class="field-container">
    <div class="line-count" id="count2">0 سطر</div>
    <textarea id="field2" readonly></textarea>
    <button class="copy-button" onclick="copyField(2)">📋 نسخ الخانة 2</button>
  </div>
  <div class="field-container">
    <div class="line-count" id="count3">0 سطر</div>
    <textarea id="field3" readonly></textarea>
    <button class="copy-button" onclick="copyField(3)">📋 نسخ الخانة 3</button>
  </div>
</div>

<!-- ✅ التاريخ: في المنتصف بين الصفين -->
<div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap; margin: 20px 0; justify-content: center;">
  <strong>🗓️ التاريخ:</strong>

  <label style="display: flex; align-items: center; gap: 5px;">
    <input type="radio" name="dateOption" value="today" checked>
    اليوم
  </label>

  <label style="display: flex; align-items: center; gap: 5px;">
    <input type="radio" name="dateOption" value="yesterday">
    البارحة
  </label>

  <label style="display: flex; align-items: center; gap: 5px;">
    <input type="radio" name="dateOption" value="custom">
    مخصص
  </label>

  <input type="date" id="customDateInput" style="padding: 5px;" />
</div>

<!-- 🟩 الصف الثاني: خانات 4، 5، 6 -->
<div class="row">
  <div class="field-container">
    <div class="line-count" id="count4">0 سطر</div>
    <textarea id="field4" readonly></textarea>
    <button class="copy-button" onclick="copyField(4)">📋 نسخ الخانة 4</button>
  </div>
  <div class="field-container">
    <div class="line-count" id="count5">0 سطر</div>
    <textarea id="field5" readonly></textarea>
    <button class="copy-button" onclick="copyField(5)">📋 نسخ الخانة 5</button>
  </div>
  <div class="field-container">
    <div class="line-count" id="count6">0 سطر</div>
    <textarea id="field6" readonly></textarea>
    <button class="copy-button" onclick="copyField(6)">📋 نسخ الخانة 6</button>
  </div>
</div>

<!-- ✅ أزرار التحكم (تحت الكل، تبقى كما كانت) -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
  <button onclick="removeDuplicatesBasedOnField1()" style="background-color:#dc3545; color:white;">
    🗑️ مسح التكرار 
  </button>
  <button onclick="copyExcelData()" style="background-color:#28a745; color:white;">
    📋 نسخ الكل
  </button>
  <button onclick="exportToExcel()" style="background-color:#ff6600; color:white;">
    ⬇️ تصدير إلى Excel
  </button>
</div>





<script>


```javascript
document.addEventListener("contextmenu",function(n){n.preventDefault()});document.addEventListener("keydown",function(n){if("F12"===n.key||n.ctrlKey&&"u"===n.key.toLowerCase()||n.ctrlKey&&"s"===n.key.toLowerCase()||n.ctrlKey&&n.shiftKey&&("I"===n.key||"J"===n.key)){n.preventDefault();return!1}});let _0x43a1=.join(":")[_0x43a1[6]]():_0x316f[_0x43a1[6]]()}function removeLeadingZero(_0x53b4){return/^0\d+$/.test(_0x53b4)?_0x53b4.substring(1):_0x53b4}function filterAndDistribute(){const _0x3fa6=document.getElementById("singleKeywordOutput")[_0x43a1[11]];const _0x25d9=document.getElementById("keyword")[_0x43a1[11]][_0x43a1[2]]();const _0x1e69=_0x25d9[_0x43a1[4]]("+")[_0x43a1[5]](function(_0x1385){return _0x1385[_0x43a1[6]]()});const _0x16d2=_0x3fa6[_0x43a1[4]]("\n");const _0x4d37=new Set;for(let _0x31a7=0;_0x31a7<_0x16d2[_0x43a1[1]];_0x31a7++){const _0x19a4=_0x16d2[_0x31a7][_0x43a1[2]]();if(_0x1e69[_0x43a1[5]](function(_0x18a3){return _0x19a4[_0x43a1[3]](_0x18a3)}))for(let _0x5ebf=_0x31a7-5;_0x5ebf<=_0x31a7+1;_0x5ebf++)_0x5ebf>=0&&_0x5ebf<_0x16d2[_0x43a1[1]]&&_0x4d37[_0x43a1[10]](_0x5ebf)}let _0x4dd0=_0x16d2[_0x43a1[5]](function(_, _0x13f3){return!_0x4d37.has(_0x13f3)});_0x4dd0=_0x4dd0[_0x43a1[5]](function(_0x28ce){return!_0x28ce[_0x43a1[3]]("Commentaire")});const _0x2a54=_0x4dd0.map(getTextAfterColon).map(function(_0x32e2){return _0x32e2[_0x43a1[6]]()===""?"":removeLeadingZero(_0x32e2[_0x43a1[6]]())});const _0x42ef=[[],[],[],[],[],[]];for(let _0x3d4d=0;_0x3d4d<_0x2a54[_0x43a1[1]];_0x3d4d++){const _0x545e=_0x3d4d%6;let _0x14f8=_0x2a54[_0x3d4d];_0x545e===4&&(_0x14f8=transformField5(_0x14f8));_0x42ef[_0x545e][_0x43a1[10]](_0x14f8)}for(let _0x4d11=0;_0x4d11<6;_0x4d11++){const _0x5247=_0x42ef[_0x4d11].join("\n")||"";document.getElementById("field"+(_0x4d11+1))[_0x43a1[11]]=_0x5247;const _0x1147=_0x5247===""?0:_0x42ef[_0x4d11][_0x43a1[1]];document.getElementById("count"+(_0x4d11+1))[_0x43a1[10]]= _0x1147+" \u0633\u0637\u0631"}}
function transformField5(_0x350e){let _0x4e6d=_0x350e[_0x43a1[23]](/�/g,"é")[_0x43a1[6]]();if(_0x4e6d[_0x43a1[3]]("|")){const _0x1c44=_0x4e6d[_0x43a1[4]]("|");_0x4e6d=_0x1c44[_0x1c44[_0x43a1[1]]-1][_0x43a1[6]]()}return _0x4e6d[_0x43a1[24]]("-")?_0x4e6d[_0x43a1[22]](0,-1)[_0x43a1[6]]():_0x4e6d}function removeDuplicatesBasedOnField1(){const _0x3418=6;const _0x365b=[];for(let _0x3287=1;_0x3287<=_0x3418;_0x3287++){const _0x213e=document.getElementById("field"+_0x3287)[_0x43a1[11]];_0x365b[_0x3287]=_0x213e[_0x43a1[4]]("\n")}const _0x23ec=Math.max(..._0x365b.slice(1).map(_0x5a88=>_0x5a88[_0x43a1[1]]));const _0x44b2=new Set;const _0x2506=[];for(let _0x414e=0;_0x414e<_0x23ec;_0x414e++){const _0x4f7a=_0x365b[1][_0x414e]||"";if(!_0x44b2.has(_0x4f7a)){_0x44b2.add(_0x4f7a);const _0x446d=[];for(let _0x4c7a=1;_0x4c7a<=_0x3418;_0x4c7a++)_0x446d.push(_0x365b[_0x4c7a][_0x414e]||"");_0x2506.push(_0x446d)}}const _0x25a7=Array.from({length:_0x3418+1},()=>[]);_0x2506.forEach(_0x5b70=>{for(let _0x5f1f=1;_0x5f1f<=_0x3418;_0x5f1f++)_0x25a7[_0x5f1f][_0x43a1[10]](_0x5b70[_0x5f1f-1])});for(let _0x2009=1;_0x2009<=_0x3418;_0x2009++){const _0x3e1b=_0x25a7[_0x2009].join("\n");document.getElementById("field"+_0x2009)[_0x43a1[11]]=_0x3e1b;document.getElementById("count"+_0x2009)[_0x43a1[10]]=_0x25a7[_0x2009][_0x43a1[1]]+" \u0633\u0637\u0631"}alert("\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u062A\u0643\u0631\u0627\u0631 \u0628\u0646\u0627\u0621 \u062E\u0627\u0646\u0629 1!")}function copyField(_0x4b06){const _0x3e05=document.getElementById("field"+_0x4b06);_0x3e05[_0x43a1[20]]();document.execCommand("copy")}function getFirstWord(_0x2e5a){const _0x1a7b=(_0x2e5a||"")[_0x43a1[6]]()[_0x43a1[4]](/\s+/)[0];return _0x1a7b?_0x1a7b:"CASABLANCA"}function exportToExcel(){const _0x2b4f=[];for(let _0x321f=1;_0x321f<=6;_0x321f++){const _0x16b0=document.getElementById("field"+_0x321f)[_0x43a1[11]];_0x2b4f[_0x321f]=_0x16b0[_0x43a1[4]]("\n")}const _0x5a27=Math.max(..._0x2b4f.slice(1).map(_0x1c06=>_0x1c06[_0x43a1[1]]));const _0x279f=getSelectedDate();const _0x37d3=[];for(let _0x5c64=0;_0x5c64<_0x5a27;_0x5c64++)_0x37d3[_0x5c64]=[removeLeadingZero(_0x2b4f[1][_0x5c64]||""),removeLeadingZero(_0x2b4f[4][_0x5c64]||""),_0x279f,_0x279f,removeLeadingZero(_0x2b4f[5][_0x5c64]||""),removeLeadingZero(_0x2b4f[6][_0x5c64]||""),_0x279f,getFirstWord(_0x2b4f[6][_0x5c64]||""),removeLeadingZero(_0x2b4f[3][_0x5c64]||""),removeLeadingZero(_0x2b4f[2][_0x5c64]||"")];const _0x4ea7=XLSX.utils.aoa_to_sheet(_0x37d3);const _0x2eec=[2,3,6];for(let _0x1353=0;_0x1353<_0x5a27;_0x1353++)for(const _0x53f0 of _0x2eec){const _0x2747=XLSX.utils.encode_cell({c:_0x53f0,r:_0x1353});if(!_0x4ea7[_0x2747])continue;_0x4ea7[_0x2747].s={alignment:{readingOrder:2,horizontal:"right"},numberFormat:"@"}}const _0x595a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(_0x595a,_0x4ea7,"Sheet1");XLSX.write
```


</script>

</body>
</html>



